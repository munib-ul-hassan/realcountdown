
<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<!-- Content Wrapper -->
<div id="content-wrapper" class="d-flex flex-column">

    <!-- Main Content -->
    <div id="content">

        <!-- Topbar -->
         <%- include('../partials/head') %>

        <!-- End of Topbar -->
        <div class="card-body" id="myDIV">
            <div class="table-responsive">
              <input
                style="float: right"
                class="btn btn-danger"
                type="reset"
                value="Delete All"
              />

              <table
                class="table table-bordered pt-2"
                id="dataTable"
                width="100%"
                cellspacing="0"
              >
                <thead>
                  <tr class="text-center">
                    <th><input type="checkbox" /></th>
                    <th>Name</th>
                    <th>Message</th>
                    <th>Action</th>
                  </tr>
                </thead>

                <tbody>
                  <% messages.forEach(message=> { %>

                    <tr class="">
                      <td class="text-center"><input type="checkbox" /></td>
                      <td class="text-center"> <%= message.senderOne.name %></td>
                      <td class="text-center"><%= message?.chat[message.chat.length - 1]?.message %>  </td>

                      <td class="text-center">
                        <button
                          type="button"
                          id="color"
                          onclick="colorChange()"
                          class="btn btn-primary"
                          data-toggle="modal"
                          data-target="#seller-<%= message.senderOne._id %>"
                        >
                          Chat
                        </button>
                      </td>
                    </tr>

                    <%  }) %>
                </tbody>
              </table>
            </div>
          </div>

<!-- <div class="container-fluid pt-3">
    <div class="text-center"><h2>Rejected Agents Chats</h2></div>
    <div class="row pt-3">

    <div class="col-xl-4 col-md-6 mb-4">
         <div class="card ">
            <div class="card-body">
               <div class="row no-gutters align-items-center">
               <div>
                     <h2>2.3%</h2>
                  </div>
                  <div class="col-auto pl-2">
                     <img style="width: 70px; border-radius: 50%; border: 1px solid lightgray;" src="./images/StandingCount.png" alt="">
                  </div>
                  <div class="col mr-2 pl-4 ">
                     <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                        Waqar
                     </div>
                     <div class="text-xs pt-2 font-weight-bold text-success text-uppercase mb-1">
                        030033303033
                     </div>
                     <div class="text-xl pt-2 font-weight-bold text-success text-uppercase mb-1">
                        *****
                     </div>
                     <div class="text-xs pt-2 font-weight-bold text-success text-uppercase mb-1">
                        51 total reviews (23 local)
                     </div>

                  </div>
                  <div>
                          <button type="button" class="btn btn-primary btn-sm">view chat</button>
                 </div>
               </div>
            </div>
         </div>
      </div>

      <div class="col-xl-4 col-md-6 mb-4">
         <div class="card ">
            <div class="card-body">
               <div class="row no-gutters align-items-center">
               <div>
                     <h2>2.5%</h2>
                  </div>
                  <div class="col-auto pl-2">
                     <img style="width: 70px; border-radius: 50%; border: 1px solid lightgray;" src="./images/StandingCount.png" alt="">
                  </div>
                  <div class="col mr-2 pl-4 ">
                     <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                        Waqar
                     </div>
                     <div class="text-xs pt-2 font-weight-bold text-success text-uppercase mb-1">
                        030033303033
                     </div>
                     <div class="text-xl pt-2 font-weight-bold text-success text-uppercase mb-1">
                        *****
                     </div>
                     <div class="text-xs pt-2 font-weight-bold text-success text-uppercase mb-1">
                        51 total reviews (23 local)
                     </div>

                  </div>
                  <div>
                          <button type="button" class="btn btn-primary btn-sm">view chat</button>
                 </div>
               </div>
            </div>
         </div>
      </div> -->

      <!-- <div class="card-body" id="myDIV">
            <div class="table-responsive">
              <input
                style="float: right"
                class="btn btn-danger"
                type="reset"
                value="Delete All"
              /> -->


            </div>
          </div>





    </div>
</div>








        <!-- /.container-fluid -->

    </div>
    <!-- End of Main Content -->
<!-- popup -->
<div
            class="modal fade"
            id="exampleModal"
            tabindex="-1"
            role="dialog"
            aria-labelledby="exampleModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5
                    class="modal-title"
                    style="color: green; padding-left: 100px"
                    id="exampleModalLabel"
                  >
                    Current Chat
                  </h5>
                  <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                  >
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="container d-flex justify-content-center">
                    <div class="card card_chat">
                      <div
                        class="d-flex flex-row justify-content-between adiv text-white"
                      >
                        <i class="fas fa-chevron-left"></i>
                        <span class="pb-3">Live chat</span>
                        <i class="fas fa-times"></i>
                      </div>
                      <div class="d-flex flex-row p-3">
                        <img
                          src="https://img.icons8.com/color/48/000000/circled-user-female-skin-type-7.png"
                          width="30"
                          height="30"
                        />
                        <div class="chat ml-2 p-3">
                          Hello Mr. Waqar! I bid on your property i want more
                          details
                        </div>
                      </div>
                      <div class="d-flex flex-row p-3">
                        <div class="bg-white mr-2 p-3">
                          <span class="text-muted"
                            >Hello Mr. Zaher thanks for bid on my property</span
                          >
                        </div>
                        <img
                          src="https://img.icons8.com/color/48/000000/circled-user-male-skin-type-7.png"
                          width="30"
                          height="30"
                        />
                      </div>

                      <div class="form-group px-3">
                        <textarea
                          class="form-control"
                          rows="2"
                          placeholder="Type your message"
                        ></textarea>
                      </div>
                      <button type="button" class="btn btn-primary">
                        Send Message
                      </button>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>








          <%messages.forEach(message => { %>

            <div
                        class="modal fade"
                        id="seller-<%= message.senderOne._id %>"
                        tabindex="-1"
                        role="dialog"
                        aria-labelledby="exampleModalLabel"
                        aria-hidden="true"
                      >
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5
                                class="modal-title"
                                style="color: green; padding-left: 100px"
                                id="exampleModalLabel"
                              >
                                Current Chat
                              </h5>
                              <button
                                type="button"
                                class="close"
                                data-dismiss="modal"
                                aria-label="Close"
                              >
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-body">
                              <div class="container d-flex justify-content-center">
                                <div class="card card_chat">
                                  <div
                                    class="d-flex flex-row justify-content-between adiv text-white"
                                  >
                                    <i class="fas fa-chevron-left"></i>
                                    <span class="pb-3">Live chat</span>
                                    <i class="fas fa-times"></i>
                                  </div>
                                  <% message.chat.forEach(chat => { %>
                                  <% if(!chat.senderId.equals(agentId)){ %>
                                  <div class="d-flex flex-row p-3">
                                    <img
                                      src="<%= message.senderOne.profilePicture ? message.senderOne.profilePicture : '/img/undraw_profile.svg' %>"
                                      width="30"
                                      height="30"
                                    />
                                    <div class="chat ml-2 p-3">
                                    <%= chat.message %>
                                    </div>
                                  </div>
                                  <% }else{ %>
                                  <div class="d-flex flex-row p-3 justify-content-end">
                                    <div class="bg-white mr-2 p-3 justify-content-end">
                                      <span class="text-muted"
                                        > <%= chat.message %></span
                                      >
                                    </div>
                                    <img
                                      src="<%= profilePicture ? profilePicture : '/img/undraw_profile.svg' %>"
                                      width="30"
                                      height="30"
                                    />
                                  </div>
                                  <% } })%>
                                  <form action="/agent/chat-seller/<%= message.senderOne._id %>/2" method="POST">
                                    <div class="form-group px-3">
                                      <textarea
                                        class="form-control"
                                        rows="2"
                                        placeholder="Type your message"
                                        name="message"
                                      ></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                      Send Message
                                    </button>
                                </form>
                                </div>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button
                                type="button"
                                class="btn btn-secondary"
                                data-dismiss="modal"
                              >
                                Close
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>

            <%  }) %>


          <!-- End of Page Wrapper -->

          <%- include('../partials/scripts') %>



<style>



.card_chat {
    width: 800px;
    border: none;
    border-radius: 15px
}



.chat {
    border: none;
    background: #E2FFE8;
    font-size: 20px;
    border-radius: 20px
}

.bg-white {
    border: 1px solid #E7E7E9;
    font-size: 20px;
    border-radius: 20px
}


.form-control {
    border-radius: 12px;
    border: 1px solid #F0F0F0;
    font-size: 20px
}

.form-control:focus {
    box-shadow: none
}

.form-control::placeholder {
    font-size: 20px;
    color: #C4C4C4
}
</style>


