<%- include("../partials/admin/header") %>
<body id="page-top">
  <!-- Page Wrapper -->
  <div id="wrapper">
    <!-- Sidebar -->
    <%- include("../partials/admin/navbar") %>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
      <!-- Main Content -->
      <div id="content">
        <!-- Topbar -->
        <%- include("../partials/admin/top-nav") %>
        <!-- End of Topbar -->


          <!-- Begin Page Content -->
          <div class="container-fluid">
            <!-- DataTales Example -->
            <div class="card shadow mb-4">
              <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                  Agent To Buyer
                </h6>
              </div>

              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-bordered"
                    id="dataTable"
                    width="100%"
                    cellspacing="0"
                  >
                    <thead>
                      <tr class="text-center">
                        <th>Agent Name(Sender)</th>
                        <th>Buyer Name (Recevier)</th>
                        <th>Reveiew</th>
                      </tr>
                    </thead>

                    <tbody>
                      <% buyers.forEach(person=>{ %>

                        <% person.promotionalMessages.forEach((message, index)=> { %>

                      <tr class="">
                        <td class="text-center"><%= message.agentId.name %></td>
                        <td class="text-center"><%= person.name %></td>

                        <td class="text-center">
                          <button
                            type="button"
                            class="btn btn-primary"
                            data-toggle="modal"
                            class=".bd-example-modal-lg"
                            data-target="#modal-<%= message._id %>"
                          >
                            Review
                          </button>

                          <div
                            class="modal fade bd-example-modal-lg"
                            tabindex="-1"
                            id="modal-<%= message._id %>"
                            role="dialog"
                            aria-labelledby="myLargeModalLabel"
                            aria-hidden="true"
                          >
                            <div class="modal-dialog modal-lg">
                              <div class="modal-content">
                                <form action="/admin/edit-promotional-message/<%= message._id %>/<%= person._id %>" method="POST">
                                  <button
                                    type="button"
                                    class="close pr-1"
                                    data-dismiss="modal"
                                    aria-label="Close"
                                  >
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                  <div class="row pl-3">
                                    <div class="col-md-9">
                                      <div class="form-group">
                                        <label
                                          for="message-text"
                                          class="col-form-label"
                                          >Message:</label
                                        >
                                        <textarea
                                          class="form-control"
                                          id="message-text"
                                          name="message"
                                        ><%= message.message %></textarea
                                        >
                                      </div>
                                    </div>
                                    <% if(message.approve || message.approve === false){ %>
                                    <div class="col-md-3 d-flex">
                                      <input
                                        class="btn btn-primary  col-md-6 m-1"
                                        style="
                                          height: 40px;
                                          position: relative;
                                          top: 45px;
                                        "
                                        name="action"
                                        type="submit"
                                        value="Edit"
                                      />
                                      <% }if(!message.approve){ %>
                                      <input
                                        class="btn btn-primary m-1"
                                        style="
                                          height: 40px;
                                          position: relative;
                                          top: 45px;
                                        "
                                        name="action"
                                        type="submit"
                                        value="Approve"
                                      />
                                      <% } %>
                                    </div>
                                  </div>
                                </form>

                                <div class="modal-footer">
                                  <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-dismiss="modal"
                                  >
                                    Close
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>


                        </td>

                      </tr>
                      <%  })}) %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>


          <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->

               <!-- End of Main Content -->
               <%- include("../partials/footer") %>

               <!-- Bootstrap core JavaScript-->
             </body>

             <%- include("../partials/scripts") %>
           </html>

